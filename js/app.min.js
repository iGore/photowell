var AlbumsCtrl,FriendsCtrl,MetaCtrl,Photowell,StreamCtrl,UserCtrl;FB.init({appId:"544498978935917",frictionlessRequests:true,status:true,cookie:true});$(function(){return $(".fancybox").fancybox({openEffect:"elastic",closeEffect:"elastic",helpers:{title:{type:"over"}}})});Photowell=angular.module("Photowell",[]);Photowell.config(function(a){return a.when("/",{controller:UserCtrl,templateUrl:"views/user.html"}).when("/stream",{controller:StreamCtrl,templateUrl:"views/stream.html"}).when("/friends",{controller:FriendsCtrl,templateUrl:"views/friends.html"}).when("/albums",{controller:AlbumsCtrl,templateUrl:"views/albums.html"}).otherwise({redirectTo:"/"})});Photowell.run(function(a){a.needLoad=function(){return $(window).scrollTop()>=($(document).height()-$(window).height())*0.9};a.hasScrollBar=function(){return $(document).height()!==$(window).height()+$(window).scrollTop()};return a.formatImage=function(c){var b;if(c.images[4]>=320){b=c.images[4].source}else{if(c.images[3]>=320){b=c.images[3].source}else{b=c.images[2].source}}return{src:b,src_large:c.images[0].source,name:c.name!=null?c.name:void 0}}});Photowell.factory("User",function(a){var b;b={name:"",username:"",picture:"",access_token:"",user_photos:[],user_photos_data:[]};return{set:function(c,e,d){if(d==null){d=true}b[c]=e;if(d){a.$broadcast(c,e)}return this},push:function(c,e,d){if(d==null){d=true}b[c].push(e);if(d){a.$broadcast(c,e)}return this},merge:function(c,e,d){if(d==null){d=true}return this.set(c,$.merge(b[c],e),d)},get:function(c){return b[c]}}});Photowell.factory("Friends",function(a){var b;b={friends_photos_data:[],friends_photos:[]};return{set:function(c,e,d){if(d==null){d=true}b[c]=e;if(d){a.$broadcast(c,e)}return this},push:function(c,e,d){if(d==null){d=true}b[c].push(e);if(d){a.$broadcast(c,e)}return this},merge:function(c,e,d){if(d==null){d=true}return this.set(c,$.merge(b[c],e),d)},get:function(c){return b[c]}}});Photowell.factory("Overlay",function(a){var b;b=null;return{set:function(c){b=c;return this},get:function(){return b}}});Photowell.factory("Monitor",function(b){var a;a="in_process";return{set:function(c,d){a[c]=d;return this},get:function(c){return a[c]}}});Photowell.directive("photoWall",function(a){return function(d,c,b){if(!d.$last){return}return a(function(){d.container.freetile({animate:true});return d.monitor.set("in_process",false)})}});Photowell.directive("whenScrolled",function(){return function(b,d,a){var c;c=function(e){return b.check()};return angular.element(window).bind("scroll load",c)}});MetaCtrl=function(b,d,c,a){a.set($(".overlay"));FB.getLoginStatus(function(e){if(e.status==="connected"){return c.set("access_token",e.authResponse.accessToken)}else{b.$apply(function(){if(d.$$path!=="/"){return d.path("/")}});return a.get().fadeIn()}});b.login=function(){return FB.login(function(e){if(e.authResponse){return c.set("access_token",e.authResponse.accessToken)}},{scope:"email,user_photos,friends_photos,user_photo_video_tags,friends_photo_video_tags"})};b.init=function(){return FB.api("/me?fields=name,username,albums,photos,picture.type(large)&access_token="+c.get("access_token"),function(e){c.set("picture",e.picture.data.url);c.set("name",e.name);c.set("username",e.username);c.set("user_photos_data",$.map(e.photos.data,function(f){return b.formatImage(f)}));angular.forEach(e.albums.data,function(f){return FB.api("/"+f.id+"/photos?fields=name,images&access_token="+c.get("access_token"),function(g){return c.merge("user_photos_data",$.map(g.data,function(h){return b.formatImage(h)}))})});return a.get().fadeOut("slow")})};b.$on("name",function(f,e){return b.$apply(function(){return b.name=e})});return b.$on("access_token",function(e,f){return b.init()})};UserCtrl=function(b,d,a,c){b.container=$(".container");b.monitor=c.set("in_process",false);b.name=d.get("name");b.username=d.get("username");b.picture=d.get("picture");b.photos=d.get("user_photos");b.check=function(){if((b.needLoad()||!b.hasScrollBar())&&!b.monitor.get("in_process")){if(d.get("user_photos_data").length===0){return}b.monitor.set("in_process",true);d.merge("user_photos",d.get("user_photos_data").slice(0,20));d.set("user_photos_data",d.get("user_photos_data").slice(20),false);return angular.forEach(d.get("user_photos_data").slice(0,20),function(e){return(new Image()).src=e.src})}};b.$on("name",function(f,e){return b.$apply(function(){return b.name=e})});b.$on("username",function(e,f){return b.$apply(function(){return b.username=f})});b.$on("picture",function(e,f){return b.$apply(function(){return b.picture=f})});b.$on("user_photos",function(f,e){return b.$apply(function(){return b.photos=e})});b.$on("user_photos_data",function(f,e){return b.check()});if(d.get("user_photos_data").length!==0){return b.check()}};StreamCtrl=function(a){};FriendsCtrl=function(b,a,d,c){b.container=$(".container");b.monitor=c.set("in_process",false);b.images=a.get("friends_photos");b.init=function(){return FB.api("/me/friends?fields=name,username,albums,picture.type(square)&access_token="+d.get("access_token"),function(e){return angular.forEach(e.data,function(f){return FB.api("/"+f.id+"/photos?fields=name,images&access_token="+d.get("access_token"),function(h){var g;g=$.map(h.data,function(i){return b.formatImage(i)});return a.set("friends_photos_data",$.merge(a.get("friends_photos_data"),g))})})})};b.check=function(){var e;console.log("Process: "+b.monitor.get("in_process"));console.log("needLoad: "+b.needLoad());console.log("ScrollBar: "+b.hasScrollBar());if((b.needLoad()||!b.hasScrollBar())&&!b.monitor.get("in_process")){if(a.get("friends_photos_data").length<20){return}console.log(a.get("friends_photos_data").length);b.monitor.set("in_process",true);e=a.get("friends_photos_data").slice(0,20);a.set("friends_photos_data",a.get("friends_photos_data").slice(20));a.merge("friends_photos",e);return angular.forEach(a.get("friends_photos_data").slice(0,20),function(f){return(new Image()).src=f.src})}};b.$on("friends_photos",function(e,f){console.log(f);return b.$apply(function(){return b.images=f})});b.$on("friends_photos_data",function(f,e){return b.check()});b.$on("access_token",function(f,e){return b.init()});if(a.get("friends_photos_data").length!==0){b.check()}if(d.get("access_token")){return b.init()}};AlbumsCtrl=function(a){};