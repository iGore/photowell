var AlbumsCtrl,FriendsCtrl,Photowell,PhotowellCtrl,UserCtrl;$(function(){$.fn.needLoad=function(){return $(window).scrollTop()>=($(document).height()-$(window).height())*0.9};return $(".fancybox").fancybox({openEffect:"elastic",closeEffect:"elastic",helpers:{title:{type:"inside"}}})});FB.init({appId:"544498978935917",frictionlessRequests:true,status:true,cookie:true});Photowell=angular.module("Photowell",[]);Photowell.config(function(a){return a.when("/",{controller:UserCtrl,templateUrl:"views/user.html"}).when("/stream",{controller:PhotowellCtrl,templateUrl:"views/stream.html"}).when("/friends",{controller:FriendsCtrl,templateUrl:"views/friends.html"}).when("/albums",{controller:AlbumsCtrl,templateUrl:"views/albums.html"}).otherwise({redirectTo:"/"})});Photowell.factory("User",function(a){var b;b={name:"",albums:[],picture:"",access_token:"",photos:[]};return{set:function(c,d){if(b[c] instanceof Array){return b[c].push(d)}else{return b[c]=d}},get:function(c){return b[c]}}});Photowell.directive("photoWall",function(a){return function(d,c,b){if(d.$last){return a(function(){return d.imageContainer.freetile({animate:true})})}}});Photowell.directive("whenScrolled",function(){return function(c,e,a){var b,d;b=e[0];d=function(f){return c.check()};return angular.element(window).bind("scroll load",d)}});UserCtrl=function(a,b){a.user={};a.overlay=$(".overlay");a.imageContainer=$(".container");a.init=function(){return FB.getLoginStatus(function(c){if(c.status==="connected"){b.set("access_token",c.authResponse.accessToken);return a.initUser()}else{return a.overlay.fadeIn()}})};a.login=function(){return FB.login(function(c){if(c.authResponse){b.set("access_token",c.authResponse.accessToken)}return a.initUser()},{scope:"email,user_photos,friends_photos,user_photo_video_tags,friends_photo_video_tags"})};return a.initUser=function(){return FB.api("/me?fields=name,username,albums,photos,picture.type(large)&access_token="+b.get("access_token"),function(c){b.set("picture",c.picture.data.url);b.set("albums",c.albums.data);b.set("name",c.name);b.set("username",c.username);$.each(c.photos.data,function(e,d){var f;if(d.images[4]>=320){f=d.images[4].source}else{if(d.images[3]>=320){f=d.images[3].source}else{f=d.images[2].source}}return b.set("photos",{src:f,src_large:d.images[0].source,name:d.name!=null?d.name:void 0})});a.$apply(function(){a.name=b.get("name");a.picture=b.get("picture");a.username=b.get("username");return a.photos=b.get("photos")});return a.overlay.fadeOut("slow")})}};FriendsCtrl=function(a,c,b){a.friends=[];a.images=[];a.images_container=[];a.imageContainer=$(".container");return FB.getLoginStatus(function(d){if(d.status!=="connected"){a.$apply(function(){return c.path("/")})}else{FB.api("/me/friends?fields=name,username,albums,picture.type(square)&access_token="+b.get("access_token"),function(e){a.friends=[];a.images=[];return $.each(e.data,function(g,f){a.$apply(function(){return a.friends.push({picture:f.picture.data.url,name:f.name,username:f.username})});if(!(f.albums!=null)){return true}return FB.api("/"+f.id+"/photos?fields=name,images,source&access_token="+b.get("access_token"),function(i){var h;h=[];$.each(i.data,function(j,l){var k;if(l.images[4]>=320){k=l.images[4].source}else{if(l.images[3]>=320){k=l.images[3].source}else{k=l.images[2].source}}return h.push({src:k,src_large:l.images[0].source,name:l.name!=null?l.name:void 0})});a.$apply(function(){return $.merge(a.images_container,h)});return a.check()})})})}return a.check=function(){if($("").needLoad()){return a.$apply(function(){$.merge(a.images,a.images_container.slice(0,20));return a.images_container=a.images_container.slice(20)})}}})};AlbumsCtrl=function(a){};PhotowellCtrl=function(a){a.friends=[];a.images=[];a.imageContainer=$(".container");console.log("Photowell");return a.login=function(){return FB.login(function(b){var c;if(b){c=b.authResponse.accessToken}return FB.api("/me/friends?fields=name,username,albums,picture.type(square)&access_token="+c,function(d){a.friends=[];a.images=[];return $.each(d.data,function(f,e){a.$apply(function(){return a.friends.push({picture:e.picture.data.url,name:e.name,username:e.username})});if(!(e.albums!=null)){return true}FB.api("/"+e.id+"/photos?fields=name,images,source&access_token="+c,function(h){var g;g=[];$.each(h.data,function(i,k){var j;if(k.images[4]>=320){j=k.images[4].source}else{if(k.images[3]>=320){j=k.images[3].source}else{j=k.images[2].source}}return g.push({src:j,name:k.name!=null?k.name:void 0})});return a.$apply(function(){return $.merge(a.images,g)})});return 3>a.friends.length})})},{scope:"email,user_photos,friends_photos,user_photo_video_tags,friends_photo_video_tags"})}};